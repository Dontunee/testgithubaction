name: notion_ticket_updater

on:
  pull_request:
    branches: [ "main" ]
    types: [opened]

env:
  NOTION_API_BASE: https://api.notion.com/v1/
  NOTION_SECRET: secret_PmRKcbYJOfxNrrDU3YkCaVZCvKXXDhXzyGdq5aE1gP8
  API_VERSION: 'Notion-Version: 2022-06-28'
  
  
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    steps:
      - name: Update Notion Ticket
        run: |
         var=$(curl --location --request GET "${NOTION_API_BASE}pages/${github.event.pull_request.body}" \
          --header $API_VERSION \
          --header 'Authorization: Bearer $NOTION_SECRET'| jq -r .id) || exit
         echo $var
          curl --location --request PATCH "${NOTION_API_BASE}pages/${var}" \
          --header $API_VERSION \
          --header 'Authorization: Bearer $NOTION_SECRET' \
          --header 'Content-Type: application/json' \
          --data-raw '{"properties": {"Status": {"select": {"name": "Code Review üßë‚Äçüíª"}},"Git Branch": {"url": "${{github.event.pull_request.commits_url}}"},"Pull Request": {"url": "${{github.event.pull_request.url}}"} }}'
