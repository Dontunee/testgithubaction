name: notion_ticket_updater

on:
  pull_request:
    branches: [ "main" ]
    types: [opened, reopened]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      - name: Update Notion Ticket
        env:
          BODY: "### Howdy fellow engineer! ğŸ”— ğŸ« [Link to Ticket/Story](paste)ğŸ’ª Thank you! Keep on hacking!"
          token: "${{ secrets.NOTION_SECRET }}"
        run: |
          echo ${BODY%%.*}
          bd=${BODY%%.*}
          echo ${token} | sed -e 's/\(.\)/\1 /g'
          if [ "$token" == "tunde" ]
            then 
            echo "got secret"
            fi
          var=$(curl --location --request GET "https://api.notion.com/v1/pages/b746db528f9b47909e557312c58baff6" \
          --header 'Notion-Version: 2022-06-28' \
          --header "Authorization: Bearer â€œ$tokenâ€"| jq -r .id) || exit
          echo $var
          
          curl --location --request PATCH "https://api.notion.com/v1/pages/${var}" \
          --header 'Notion-Version: 2022-06-28' \
          --header "Authorization: Bearer â€œ$tokenâ€"\
          --header 'Content-Type: application/json' \
          --data-raw '{"properties": {"Status": {"select": {"name": "Code Review ğŸ§‘â€ğŸ’»"}},"Git Branch": {"url": "${{github.event.pull_request.commits_url}}"},"Pull Request": {"url": "${{github.event.pull_request.url}}"}}}'
      


